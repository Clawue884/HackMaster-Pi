<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', path='/css/styles.css') }}">
    <title>Wi-Fi Password Cracker - HackMaster Pi</title>
    <meta name="theme-color" content="#0f0f17">
</head>
<body>
    <div class="wifi-cracker-container">
        <div class="header-container">
            <a href="/" class="back-button">‚Üê Back</a>
            <h1>Wi-Fi Password Cracker</h1>
        </div>

        <!-- Step 1: List Adapters -->
        <div class="wifi-cracker-section" id="section1">
            <h1><span class="step-indicator">1</span>List Network Adapters</h1>
            <div class="wifi-controls">
                <button class="wifi-button" onclick="listAdapters()">List Adapters</button>
            </div>
            <div id="adapterResponse"></div>
        </div>

        <!-- Step 2: Activate Monitor Mode -->
        <div class="wifi-cracker-section" id="section2">
            <h1><span class="step-indicator">2</span>Activate Monitor Mode</h1>
            <div class="wifi-controls">
                <select class="wifi-select" id="interfaceSelect">
                    <option value="">-- Select an interface --</option>
                </select>
                <button class="wifi-button" onclick="activateMonitorMode()">Activate Monitor Mode</button>
            </div>
            <div class="wifi-status" id="monitorStatus">Select a network interface to check its status</div>
        </div>

        <!-- Step 3: Scan Wi-Fi Networks -->
        <div class="wifi-cracker-section" id="section3">
            <h1><span class="step-indicator">3</span>Scan Wi-Fi Networks</h1>
            <div class="wifi-controls">
                <button class="wifi-button" id="scanButton" onclick="scanWifiNetworks()">Scan Wi-Fi Networks</button>
            </div>
            <div id="scanResponse">
                <div id="loadingIndicator" class="loading-indicator" style="display: none;">
                    Scanning for Wi-Fi networks...
                </div>
                <div id="scanResults" style="display: none;">
                    <h3>Scan Results:</h3>
                    <table class="wifi-networks-table" id="networksTable">
                        <thead>
                            <tr>
                                <th>BSSID</th>
                                <th>Channel</th>
                                <th>Encryption</th>
                                <th>ESSID</th>
                            </tr>
                        </thead>
                        <tbody id="networksTableBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Step 4: Select Target & Set Channel -->
        <div class="wifi-cracker-section" id="section4">
            <h1><span class="step-indicator">4</span>Select Target & Set Channel</h1>
            <div class="wifi-controls">
                <select class="wifi-select" id="targetSelect">
                    <option value="">-- Select a target --</option>
                </select>
                <button class="wifi-button" onclick="setChannel()">Set Channel</button>
            </div>
            <div class="wifi-status" id="channelStatus">Select a target network to set its channel</div>
        </div>

        <!-- Step 5: Start Traffic Capture -->
        <div class="wifi-cracker-section" id="section5">
            <h1><span class="step-indicator">5</span>Start Traffic Capture</h1>
            <div class="wifi-controls">
                <button class="wifi-button success" id="startCaptureButton" onclick="startCapture()">Start Capturing</button>
            </div>
            <div class="wifi-status" id="captureStatus">Ready to start capturing traffic</div>
        </div>

        <!-- Step 6: Send Deauth Packets -->
        <div class="wifi-cracker-section" id="section6">
            <h1><span class="step-indicator">6</span>Send Deauth Packets</h1>
            <div class="wifi-controls">
                <label for="packetCount">Packets:</label>
                <input type="number" class="wifi-input" id="packetCount" value="10" min="1" max="100">
                <button class="wifi-button danger" id="sendDeauthButton" onclick="sendDeauthPackets()">Send Deauth Packets</button>
            </div>
            <div class="wifi-status" id="deauthStatus">Configure packet count and send deauth packets</div>
        </div>

        <!-- Step 7: Stop Capture -->
        <div class="wifi-cracker-section" id="section7">
            <h1><span class="step-indicator">7</span>Stop Traffic Capture</h1>
            <div class="wifi-controls">
                <button class="wifi-button danger" id="stopCaptureButton" onclick="stopCapture()" disabled>Stop Capturing</button>
            </div>
            <div class="wifi-status" id="stopCaptureStatus">Capture will be stopped when ready</div>
        </div>

        <!-- Step 8: Check Handshakes -->
        <div class="wifi-cracker-section" id="section8">
            <h1><span class="step-indicator">8</span>Check Handshakes</h1>
            <p>Analyze captured packets for WPA handshakes.</p>
            <div class="wifi-controls">
                <button class="wifi-button" id="checkHandshakeButton" onclick="checkHandshakes()">Check Handshakes</button>
            </div>
            <div class="wifi-status" id="handshakeStatus">Click to check for captured handshakes</div>
        </div>

        <!-- Step 9: Password Cracking -->
        <div class="wifi-cracker-section" id="section9">
            <h1><span class="step-indicator">9</span>Password Cracking</h1>
            <p>Select a wordlist and crack the captured handshake.</p>
            <div class="wifi-controls">
                <button class="wifi-button" id="loadWordlistsButton" onclick="loadWordlists()">Load Available Wordlists</button>
            </div>
            <div class="wordlist-section" id="wordlistSection" style="display: none;">
                <label for="wordlistSelect">Select wordlist:</label>
                <select class="wifi-select" id="wordlistSelect">
                    <option value="">-- Select a wordlist --</option>
                </select>
                <button class="wifi-button success" id="crackPasswordButton" onclick="crackPassword()">Crack Password</button>
            </div>
            <div class="wifi-status" id="crackStatus" style="display: none;"></div>
            <div id="crackResults" style="display: none;">
                <h4>Cracking Results:</h4>
                <div id="passwordResult"></div>
            </div>
        </div>
    </div>

    <script>
        let selectedInterface = '';
        let scannedNetworks = [];
        let selectedTarget = null;
        let targetChannel = null;
        let targetBSSID = null;
        let targetESSID = null;

        // Ê≠•È©üÁÆ°ÁêÜÂáΩÊï∏
        function markStepCompleted(sectionId) {
            const section = document.getElementById(sectionId);
            const indicator = section.querySelector('.step-indicator');
            section.classList.add('completed');
            indicator.classList.add('completed');
        }

        function markStepActive(sectionId) {
            const section = document.getElementById(sectionId);
            const indicator = section.querySelector('.step-indicator');
            section.classList.add('active');
            indicator.classList.add('active');
        }

        function clearStepActive(sectionId) {
            const section = document.getElementById(sectionId);
            const indicator = section.querySelector('.step-indicator');
            section.classList.remove('active');
            indicator.classList.remove('active');
        }

        async function listAdapters() {
            try {
                const response = await fetch('/WiFi/interface/details');
                const data = await response.json();
                
                const responseDiv = document.getElementById('adapterResponse');
                
                if (data.success) {
                    responseDiv.innerHTML = `
                        <div class="terminal-output">
> Success: ${data.message}
> Network adapters detected: ${data.adapters ? data.adapters.length : 0}

${data.output}
                        </div>
                    `;
                    
                    // ËºâÂÖ•Á∂≤Âç°ÈÅ∏È†Ö
                    loadInterfaceList();
                    markStepCompleted('section1');
                } else {
                    responseDiv.innerHTML = `
                        <div class="wifi-status error">
                            <strong>Error:</strong> ${data.message}
                            ${data.output ? '<pre>' + data.output + '</pre>' : ''}
                        </div>
                    `;
                }
            } catch (error) {
                document.getElementById('adapterResponse').innerHTML = `
                    <div class="wifi-status error">
                        <strong>Network Error:</strong> ${error.message}
                    </div>
                `;
            }
        }

        async function loadInterfaceList() {
            try {
                const response = await fetch('/WiFi/interface/list');
                const data = await response.json();
                
                const select = document.getElementById('interfaceSelect');
                
                if (data.success) {
                    // Ê∏ÖÁ©∫ÁèæÊúâÈÅ∏È†Ö
                    select.innerHTML = '<option value="">-- Select an interface --</option>';
                    
                    // Ê∑ªÂä†Á∂≤Âç°ÈÅ∏È†Ö
                    data.adapters.forEach(adapter => {
                        const option = document.createElement('option');
                        option.value = adapter;
                        option.textContent = adapter;
                        select.appendChild(option);
                    });
                    
                    // Áõ£ËÅΩÈÅ∏ÊìáËÆäÊõ¥
                    select.onchange = function() {
                        selectedInterface = this.value;
                        if (selectedInterface) {
                            checkInterfaceStatus(selectedInterface);
                        }
                    };
                }
            } catch (error) {
                console.error('Error loading interfaces:', error);
            }
        }

        async function activateMonitorMode() {
            if (!selectedInterface) {
                alert('Please select an interface first');
                return;
            }

            try {
                const response = await fetch('/WiFi/interface/monitorMode', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        interface: selectedInterface
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert(`Monitor mode activated for ${selectedInterface}`);
                    checkInterfaceStatus(selectedInterface);
                    markStepCompleted('section2');
                } else {
                    alert(`Failed to activate monitor mode: ${data.message}`);
                }
            } catch (error) {
                alert(`Network error: ${error.message}`);
            }
        }

        async function checkInterfaceStatus(interfaceName) {
            try {
                const response = await fetch(`/WiFi/interface/status?interface=${interfaceName}`);
                const data = await response.json();
                
                const statusElement = document.getElementById('monitorStatus');
                
                if (data.success) {
                    statusElement.className = 'wifi-status success';
                    statusElement.textContent = `Interface ${interfaceName}: ${data.status}`;
                } else {
                    statusElement.className = 'wifi-status error';
                    statusElement.textContent = `Interface ${interfaceName}: Error - ${data.message}`;
                }
            } catch (error) {
                const statusElement = document.getElementById('monitorStatus');
                statusElement.className = 'wifi-status error';
                statusElement.textContent = `Interface ${interfaceName}: Error - ${error.message}`;
            }
        }

        async function scanWifiNetworks() {
            if (!selectedInterface) {
                alert('Please select a network interface first');
                return;
            }

            const scanButton = document.getElementById('scanButton');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const scanResults = document.getElementById('scanResults');
            
            // Á¶ÅÁî®ÊéÉÊèèÊåâÈàï‰∏¶È°ØÁ§∫ËºâÂÖ•ÊåáÁ§∫Âô®
            scanButton.disabled = true;
            scanButton.textContent = 'Scanning...';
            loadingIndicator.style.display = 'block';
            scanResults.style.display = 'none';

            try {
                // Ë®≠ÂÆö fetch Ë∂ÖÊôÇÊéßÂà∂Âô®
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 45000); // 45ÁßíË∂ÖÊôÇÔºåÁµ¶Êõ¥Â§öÁ∑©Ë°ùÊôÇÈñì
                
                const response = await fetch('/WiFi/ap/scan', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        interface: selectedInterface,
                        timeout: 12  // Ê∏õÂ∞ëÂà∞ 12 ÁßíÔºåÊõ¥ÂØ¶ÈöõÁöÑÊéÉÊèèÊôÇÈñì
                    }),
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                
                const data = await response.json();
                
                if (data.success && data.ap_list) {
                    displayScanResults(data.ap_list);
                    markStepCompleted('section3');
                } else {
                    throw new Error(data.message || 'Failed to scan networks');
                }
            } catch (error) {
                if (error.name === 'AbortError') {
                    alert('Network scan timed out (45 seconds). Please try again.');
                } else {
                    alert(`Network scan failed: ${error.message}`);
                }
                scanResults.style.display = 'none';
            } finally {
                // ÊÅ¢Âæ©ÊéÉÊèèÊåâÈàï
                scanButton.disabled = false;
                scanButton.textContent = 'Scan Wi-Fi Networks';
                loadingIndicator.style.display = 'none';
            }
        }

        function displayScanResults(networks) {
            const scanResults = document.getElementById('scanResults');
            const tableBody = document.getElementById('networksTableBody');
            
            // ÂÑ≤Â≠òÊéÉÊèèÁµêÊûú
            scannedNetworks = networks;
            
            // Ê∏ÖÁ©∫Ë°®Ê†ºÂÖßÂÆπ
            tableBody.innerHTML = '';
            
            if (networks.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="4">No networks found</td></tr>';
            } else {
                networks.forEach(network => {
                    const row = document.createElement('tr');
                    
                    // BSSID
                    const bssidCell = document.createElement('td');
                    bssidCell.textContent = network.BSSID || 'Unknown';
                    row.appendChild(bssidCell);
                    
                    // Channel
                    const channelCell = document.createElement('td');
                    channelCell.textContent = network.CH || 'Unknown';
                    row.appendChild(channelCell);
                    
                    // Encryption
                    const encryptionCell = document.createElement('td');
                    encryptionCell.textContent = network.ENC || 'Unknown';
                    row.appendChild(encryptionCell);
                    
                    // ESSID
                    const essidCell = document.createElement('td');
                    essidCell.textContent = network.ESSID || '<hidden>';
                    row.appendChild(essidCell);
                    
                    tableBody.appendChild(row);
                });
            }
            
            // Êõ¥Êñ∞ÁõÆÊ®ôÈÅ∏ÊìáÂô®
            updateTargetSelect(networks);
            
            scanResults.style.display = 'block';
        }

        function updateTargetSelect(networks) {
            const targetSelect = document.getElementById('targetSelect');
            
            // Ê∏ÖÁ©∫ÁèæÊúâÈÅ∏È†Ö
            targetSelect.innerHTML = '<option value="">-- Select a target --</option>';
            
            // Ê∑ªÂä†Á∂≤Ë∑ØÈÅ∏È†Ö
            networks.forEach((network, index) => {
                const option = document.createElement('option');
                option.value = index;
                const essid = network.ESSID || '<hidden>';
                const bssid = network.BSSID || 'Unknown';
                option.textContent = `${essid} (${bssid})`;
                targetSelect.appendChild(option);
            });
        }

        async function setChannel() {
            const targetSelect = document.getElementById('targetSelect');
            const selectedIndex = targetSelect.value;
            
            if (!selectedIndex) {
                alert('Please select a target network first');
                return;
            }

            if (!selectedInterface) {
                alert('Please select a network interface first');
                return;
            }

            // Áç≤ÂèñÈÅ∏‰∏≠ÁöÑÁõÆÊ®ô
            selectedTarget = scannedNetworks[selectedIndex];
            targetChannel = selectedTarget.CH;
            targetBSSID = selectedTarget.BSSID;
            targetESSID = selectedTarget.ESSID || '<hidden>';

            const channelStatus = document.getElementById('channelStatus');
            channelStatus.textContent = 'Setting channel...';

            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 10000); // 10ÁßíË∂ÖÊôÇ
                
                const response = await fetch('/WiFi/interface/channel', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        interface: selectedInterface,
                        channel: targetChannel
                    }),
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                
                const data = await response.json();
                
                if (data.success) {
                    channelStatus.className = 'wifi-status success';
                    channelStatus.textContent = `Channel ${targetChannel} set for ${targetESSID}`;
                    markStepCompleted('section4');
                } else {
                    channelStatus.className = 'wifi-status error';
                    channelStatus.textContent = `Failed to set channel - ${data.message}`;
                }
            } catch (error) {
                const channelStatus = document.getElementById('channelStatus');
                if (error.name === 'AbortError') {
                    channelStatus.className = 'wifi-status error';
                    channelStatus.textContent = 'Channel setting timed out';
                } else {
                    channelStatus.className = 'wifi-status error';
                    channelStatus.textContent = `Error - ${error.message}`;
                }
            }
        }

        async function startCapture() {
            if (!selectedInterface) {
                alert('Please select a network interface first');
                return;
            }

            if (!targetBSSID || !targetChannel) {
                alert('Please select a target and set channel first');
                return;
            }

            const startButton = document.getElementById('startCaptureButton');
            const stopButton = document.getElementById('stopCaptureButton');
            const captureStatus = document.getElementById('captureStatus');

            // Êõ¥Êñ∞ÊåâÈàïÁãÄÊÖã
            startButton.disabled = true;
            startButton.textContent = 'Starting...';
            captureStatus.className = 'wifi-status info';
            captureStatus.textContent = 'Starting capture...';

            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 10000); // 10ÁßíË∂ÖÊôÇ
                
                const response = await fetch('/WiFi/capture/start', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        interface: selectedInterface,
                        bssid: targetBSSID,
                        channel: parseInt(targetChannel)
                    }),
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                
                const data = await response.json();
                
                if (data.success) {
                    stopButton.disabled = false;
                    captureStatus.className = 'wifi-status success';
                    captureStatus.textContent = `Capturing traffic for ${targetESSID} on channel ${targetChannel}`;
                    startButton.textContent = 'Capture Started';
                    markStepCompleted('section5');
                } else {
                    startButton.disabled = false;
                    startButton.textContent = 'Start Capturing';
                    captureStatus.className = 'wifi-status error';
                    captureStatus.textContent = `Failed to start capture - ${data.message}`;
                }
            } catch (error) {
                startButton.disabled = false;
                startButton.textContent = 'Start Capturing';
                if (error.name === 'AbortError') {
                    captureStatus.className = 'wifi-status error';
                    captureStatus.textContent = 'Capture start timed out';
                } else {
                    captureStatus.className = 'wifi-status error';
                    captureStatus.textContent = `Error - ${error.message}`;
                }
            }
        }

        async function stopCapture() {
            const startButton = document.getElementById('startCaptureButton');
            const stopButton = document.getElementById('stopCaptureButton');
            const stopCaptureStatus = document.getElementById('stopCaptureStatus');

            stopButton.disabled = true;
            stopButton.textContent = 'Stopping...';
            stopCaptureStatus.className = 'wifi-status info';
            stopCaptureStatus.textContent = 'Stopping capture...';

            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 10000); // 10ÁßíË∂ÖÊôÇ
                
                const response = await fetch('/WiFi/capture/stop', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                
                const data = await response.json();
                
                if (data.success) {
                    stopCaptureStatus.className = 'wifi-status success';
                    stopCaptureStatus.textContent = 'Capture stopped successfully';
                    stopButton.textContent = 'Capture Stopped';
                    // ÈáçÊñ∞ÂïüÁî® start ÊåâÈàï
                    startButton.disabled = false;
                    startButton.textContent = 'Start Capturing';
                    markStepCompleted('section7');
                } else {
                    stopCaptureStatus.className = 'wifi-status error';
                    stopCaptureStatus.textContent = `Failed to stop capture - ${data.message}`;
                    stopButton.disabled = false;
                    stopButton.textContent = 'Stop Capturing';
                }
            } catch (error) {
                if (error.name === 'AbortError') {
                    stopCaptureStatus.className = 'wifi-status error';
                    stopCaptureStatus.textContent = 'Capture stop timed out';
                } else {
                    stopCaptureStatus.className = 'wifi-status error';
                    stopCaptureStatus.textContent = `Error - ${error.message}`;
                }
                stopButton.disabled = false;
                stopButton.textContent = 'Stop Capturing';
            }
        }

        async function sendDeauthPackets() {
            if (!selectedInterface) {
                alert('Please select a network interface first');
                return;
            }

            if (!targetBSSID) {
                alert('Please select a target network first');
                return;
            }

            const deauthButton = document.getElementById('sendDeauthButton');
            const deauthStatus = document.getElementById('deauthStatus');
            const packetCount = document.getElementById('packetCount').value;

            // È©óË≠âÂ∞ÅÂåÖÊï∏Èáè
            const packets = parseInt(packetCount);
            if (isNaN(packets) || packets < 1 || packets > 100) {
                alert('Please enter a valid packet count (1-100)');
                return;
            }

            // Êõ¥Êñ∞ÊåâÈàïÁãÄÊÖã
            deauthButton.disabled = true;
            deauthButton.textContent = 'Sending...';
            deauthStatus.className = 'wifi-status info';
            deauthStatus.textContent = `Sending ${packets} deauth packets to ${targetESSID}...`;

            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 45000); // 45ÁßíË∂ÖÊôÇ
                
                const response = await fetch('/WiFi/deauth/send', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        interface: selectedInterface,
                        bssid: targetBSSID,
                        packets: packets,
                        broadcast: true
                    }),
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                
                const data = await response.json();
                
                if (data.success) {
                    deauthStatus.className = 'wifi-status success';
                    deauthStatus.textContent = `Successfully sent ${data.packets_sent} deauth packets to ${targetESSID}`;
                    markStepCompleted('section6');
                } else {
                    deauthStatus.className = 'wifi-status error';
                    deauthStatus.textContent = `Failed to send deauth packets - ${data.message}`;
                }
            } catch (error) {
                if (error.name === 'AbortError') {
                    deauthStatus.className = 'wifi-status error';
                    deauthStatus.textContent = 'Deauth sending timed out';
                } else {
                    deauthStatus.className = 'wifi-status error';
                    deauthStatus.textContent = `Error - ${error.message}`;
                }
            } finally {
                // ÊÅ¢Âæ©ÊåâÈàïÁãÄÊÖã
                deauthButton.disabled = false;
                deauthButton.textContent = 'Send Deauth Packets';
            }
        }

        async function checkHandshakes() {
            const checkButton = document.getElementById('checkHandshakeButton');
            const handshakeStatus = document.getElementById('handshakeStatus');

            // Êõ¥Êñ∞ÊåâÈàïÁãÄÊÖã
            checkButton.disabled = true;
            checkButton.textContent = 'Checking...';
            handshakeStatus.className = 'wifi-status info';
            handshakeStatus.textContent = 'Analyzing capture file for handshakes...';

            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 45000); // 45ÁßíË∂ÖÊôÇ
                
                const response = await fetch('/WiFi/handshake/check', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        capture_file: 'deauth_handshake-01.cap'  // ‰ΩøÁî®Êñ∞ÁöÑÊ™îÂêçÂâçÁ∂¥
                    }),
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                
                const data = await response.json();
                
                if (data.success) {
                    handshakeStatus.className = 'wifi-status success';
                    handshakeStatus.textContent = data.message;
                    markStepCompleted('section8');
                } else {
                    handshakeStatus.className = 'wifi-status error';
                    handshakeStatus.textContent = `Failed to check handshakes - ${data.message}`;
                }
            } catch (error) {
                if (error.name === 'AbortError') {
                    handshakeStatus.className = 'wifi-status error';
                    handshakeStatus.textContent = 'Handshake checking timed out';
                } else {
                    handshakeStatus.className = 'wifi-status error';
                    handshakeStatus.textContent = `Error - ${error.message}`;
                }
            } finally {
                // ÊÅ¢Âæ©ÊåâÈàïÁãÄÊÖã
                checkButton.disabled = false;
                checkButton.textContent = 'Check Handshakes';
            }
        }

        async function loadWordlists() {
            const loadButton = document.getElementById('loadWordlistsButton');
            const wordlistSection = document.getElementById('wordlistSection');
            const wordlistSelect = document.getElementById('wordlistSelect');

            // Êõ¥Êñ∞ÊåâÈàïÁãÄÊÖã
            loadButton.disabled = true;
            loadButton.textContent = 'Loading...';

            try {
                const response = await fetch('/WiFi/wordlists/list');
                const data = await response.json();
                
                if (data.success) {
                    // Ê∏ÖÁ©∫ÁèæÊúâÈÅ∏È†Ö
                    wordlistSelect.innerHTML = '<option value="">-- Select a wordlist --</option>';
                    
                    // ÊåâÈ°ûÂà•ÂàÜÁµÑ
                    const customWordlists = data.wordlists.filter(w => w.category === 'custom');
                    const standardWordlists = data.wordlists.filter(w => w.category === 'standard');
                    
                    // Ê∑ªÂä†Ëá™ÂÆöÁæ©Â≠óÂÖ∏
                    if (customWordlists.length > 0) {
                        const customGroup = document.createElement('optgroup');
                        customGroup.label = 'Custom Wordlists';
                        customWordlists.forEach(wordlist => {
                            const option = document.createElement('option');
                            option.value = wordlist.path;
                            const sizeKB = (wordlist.size / 1024).toFixed(2);
                            option.textContent = `${wordlist.filename} (${sizeKB} KB)`;
                            customGroup.appendChild(option);
                        });
                        wordlistSelect.appendChild(customGroup);
                    }
                    
                    // Ê∑ªÂä†Ê®ôÊ∫ñÂ≠óÂÖ∏
                    if (standardWordlists.length > 0) {
                        const standardGroup = document.createElement('optgroup');
                        standardGroup.label = 'Standard Wordlists';
                        standardWordlists.forEach(wordlist => {
                            const option = document.createElement('option');
                            option.value = wordlist.path;
                            const sizeKB = (wordlist.size / 1024).toFixed(2);
                            option.textContent = `${wordlist.filename} (${sizeKB} KB)`;
                            standardGroup.appendChild(option);
                        });
                        wordlistSelect.appendChild(standardGroup);
                    }
                    
                    wordlistSection.style.display = 'block';
                    loadButton.textContent = `Found ${data.count} wordlist(s)`;
                } else {
                    alert(`Failed to load wordlists: ${data.message}`);
                    loadButton.textContent = 'Load Available Wordlists';
                }
            } catch (error) {
                alert(`Error loading wordlists: ${error.message}`);
                loadButton.textContent = 'Load Available Wordlists';
            } finally {
                loadButton.disabled = false;
            }
        }

        async function crackPassword() {
            const crackButton = document.getElementById('crackPasswordButton');
            const wordlistSelect = document.getElementById('wordlistSelect');
            const crackStatus = document.getElementById('crackStatus');
            const crackResults = document.getElementById('crackResults');
            const passwordResult = document.getElementById('passwordResult');

            // Ê™¢Êü•ÊòØÂê¶ÈÅ∏Êìá‰∫ÜÂ≠óÂÖ∏
            if (!wordlistSelect.value) {
                alert('Please select a wordlist first');
                return;
            }

            // Êõ¥Êñ∞ÊåâÈàïÁãÄÊÖã
            crackButton.disabled = true;
            crackButton.textContent = 'Cracking...';
            crackStatus.className = 'wifi-status info';
            crackStatus.style.display = 'block';
            crackStatus.textContent = 'Starting password cracking... This may take several minutes.';
            crackResults.style.display = 'none';

            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 360000); // 6ÂàÜÈêòË∂ÖÊôÇ
                
                const response = await fetch('/WiFi/capture/crack', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        wordlist_file: wordlistSelect.value
                    }),
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                
                const data = await response.json();
                
                if (data.success) {
                    crackStatus.className = 'wifi-status success';
                    crackStatus.textContent = data.message;
                    
                    if (data.password_found) {
                        passwordResult.innerHTML = `
                            <div class="result-box success">
                                <h5>üéâ Password Found!</h5>
                                <p><strong>Password:</strong> <code>${data.password_found}</code></p>
                                <p><strong>Network:</strong> ${targetESSID || 'Target network'}</p>
                                <p><strong>Wordlist used:</strong> ${data.wordlist_file}</p>
                            </div>
                        `;
                        markStepCompleted('section9');
                    } else {
                        passwordResult.innerHTML = `
                            <div class="result-box error">
                                <h5>‚ùå Password Not Found</h5>
                                <p>The password was not found in the selected wordlist.</p>
                                <p><strong>Wordlist used:</strong> ${data.wordlist_file}</p>
                                <p>Try using a different or larger wordlist.</p>
                            </div>
                        `;
                    }
                    
                    crackResults.style.display = 'block';
                } else {
                    crackStatus.className = 'wifi-status error';
                    crackStatus.textContent = `Failed to crack password - ${data.message}`;
                }
            } catch (error) {
                if (error.name === 'AbortError') {
                    crackStatus.className = 'wifi-status error';
                    crackStatus.textContent = 'Password cracking timed out (6 minutes)';
                } else {
                    crackStatus.className = 'wifi-status error';
                    crackStatus.textContent = `Error - ${error.message}`;
                }
            } finally {
                // ÊÅ¢Âæ©ÊåâÈàïÁãÄÊÖã
                crackButton.disabled = false;
                crackButton.textContent = 'Crack Password';
            }
        }
    </script>
</body>
</html>