<!DOCTYPE html>
<html lang="en">
<head>
    <title>Password Wordlist Generator - HackMaster Pi</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', path='/css/styles.css') }}">
    <meta name="theme-color" content="#0f0f17">
    <style>
        .wordlist-management {
            margin-top: 40px;
            padding: 20px;
            border: 1px solid #333;
            border-radius: 8px;
            background-color: #1a1a1a;
        }
        
        .wordlist-management h2 {
            margin-top: 0;
            color: #00ffb3;
        }
        
        .wordlists-container {
            margin-top: 15px;
        }
        
        .wordlists-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        .wordlists-table th,
        .wordlists-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #333;
        }
        
        .wordlists-table th {
            background-color: #2a2a2a;
            color: #00ffb3;
            font-weight: bold;
        }
        
        .wordlists-table tr:hover {
            background-color: #2a2a2a;
        }
        
        .action-btn {
            padding: 6px 12px;
            margin: 0 3px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            text-decoration: none;
            font-size: 12px;
            display: inline-block;
        }
        
        .download-btn {
            background-color: #007bff;
            color: white;
        }
        
        .download-btn:hover {
            background-color: #0056b3;
        }
        
        .delete-btn {
            background-color: #dc3545;
            color: white;
        }
        
        .delete-btn:hover {
            background-color: #c82333;
        }
        
        #refreshWordlists {
            background-color: #28a745;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        #refreshWordlists:hover {
            background-color: #218838;
        }
        
        #refreshWordlists:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-container">
            <a href="/" class="back-button">← Back</a>
            <h1>Password Wordlist Generator</h1>
        </div>
        <div class="form-group">
            <p>Enter personal information to generate a targeted wordlist.</p>
            <p>Add all relevant information about the target.</p>
            
            <h2>Information Guide</h2>
            <div class="info-guide">
                <p>The following information types can be used to generate an effective password wordlist. Please provide as much relevant information as possible:</p>
                
                <h3>Personal Identifiers</h3>
                <ul>
                    <li><strong>Name:</strong> Full names, nicknames, or aliases of the target person and their close associates (family members, friends, partners). Also consider including organization names or their abbreviations if relevant.</li>
                    <li><strong>ID:</strong> National identification numbers, company unified business numbers, or other official identification codes.</li>
                </ul>
                
                <h3>Contact Information</h3>
                <ul>
                    <li><strong>Phone Number:</strong> Mobile or landline numbers, including the two-digit area code prefix. Consider both current and previous numbers.</li>
                    <li><strong>SSID:</strong> Wi-Fi network names (SSIDs) used at home, work, or frequently visited locations.</li>
                </ul>
                
                <h3>Important Dates</h3>
                <ul>
                    <li><strong>Date:</strong> Significant dates in the format YYYY-MM-DD, such as:
                        <ul>
                            <li>Birthdays (target's own or those of close associates)</li>
                            <li>Anniversaries or memorable events</li>
                            <li>Current date or other relevant timeframes</li>
                        </ul>
                    </li>
                </ul>
                
                <p><em>Note: The more accurate and comprehensive the information provided, the more effective the generated wordlist will be.</em></p>
            </div>
        </div>
        
        <form id="wordlistForm">
            <div class="form-group">
                <label for="output_filename">Output Filename:</label>
                <input type="text" id="output_filename" name="output_filename" placeholder="wordlist.txt" required>
            </div>
            
            <div class="form-group">
                <h2>Personal Information:</h2>
                <div id="info-container">
                    <!-- 資訊類別區塊會動態加入這裡 -->
                </div>
                
                <div class="input-group">
                    <select id="new_info_type">
                        <option value="date">Date</option>
                        <option value="tel">Phone Number</option>
                        <option value="name">Name</option>
                        <option value="ID">ID Number</option>
                        <option value="SSID">Wi-Fi SSID</option>
                    </select>
                    <button type="button" class="add-btn" onclick="addInfoType()">+ Add Info Type</button>
                </div>
            </div>
            
            <button type="submit">Generate Wordlist</button>
        </form>
        
        <div class="terminal-output" id="output">
> System ready for wordlist generation...
> Enter target information and submit to begin.
        </div>
        
        <div class="status" id="status" style="display: none;">
            Processing request...
        </div>
        
        <div class="wordlist-management">
            <h2>Generated Wordlists</h2>
            <button type="button" id="refreshWordlists" onclick="loadCustomWordlists()">Refresh List</button>
            <div id="wordlistsList" class="wordlists-container">
                <p>Click "Refresh List" to load your generated wordlists.</p>
            </div>
        </div>
    </div>
    
    <script>
        // 用來存儲所有資訊的物件
        let infoData = {};
        
        // 添加新的資訊類別
        function addInfoType() {
            const infoType = document.getElementById('new_info_type').value;
            const infoTypeText = document.getElementById('new_info_type').options[document.getElementById('new_info_type').selectedIndex].text;
            
            // 檢查是否已存在此類別
            if (document.getElementById(`section-${infoType}`)) {
                alert(`${infoTypeText} is already added.`);
                return;
            }
            
            // 初始化資料結構
            if (!infoData[infoType]) {
                infoData[infoType] = [];
            }
            
            const container = document.getElementById('info-container');
            
            // 創建新的資訊類別區塊
            const sectionDiv = document.createElement('div');
            sectionDiv.className = 'info-section';
            sectionDiv.id = `section-${infoType}`;
            
            sectionDiv.innerHTML = `
                <div class="info-section-title">
                    <h3>${infoTypeText}</h3>
                    <button type="button" class="delete-btn" onclick="removeInfoType('${infoType}')">Remove this type</button>
                </div>
                <div class="input-group">
                    <input type="text" id="new_value_${infoType}" placeholder="Enter ${infoTypeText.toLowerCase()} value">
                    <button type="button" class="add-btn" onclick="addInfoValue('${infoType}')">Add</button>
                </div>
                <div class="info-values" id="values-${infoType}">
                    <!-- 該類別的值會動態加入這裡 -->
                </div>
            `;
            
            container.appendChild(sectionDiv);
        }
        
        // 移除資訊類別
        function removeInfoType(infoType) {
            const sectionElement = document.getElementById(`section-${infoType}`);
            if (sectionElement) {
                sectionElement.remove();
                // 從資料中移除
                delete infoData[infoType];
            }
        }
        
        // 添加資訊值
        function addInfoValue(infoType) {
            const inputElement = document.getElementById(`new_value_${infoType}`);
            const value = inputElement.value.trim();
            
            if (!value) {
                alert("Please enter a value.");
                return;
            }
            
            // 檢查是否重複
            if (infoData[infoType].includes(value)) {
                alert("This value is already added.");
                return;
            }
            
            // 添加到資料
            infoData[infoType].push(value);
            
            // 添加到 UI
            const valuesContainer = document.getElementById(`values-${infoType}`);
            const valueElement = document.createElement('div');
            valueElement.className = 'value-tag';
            valueElement.innerHTML = `
                ${value} <button type="button" class="delete-btn" onclick="removeInfoValue('${infoType}', '${value}')">X</button>
            `;
            
            valuesContainer.appendChild(valueElement);
            
            // 清空輸入框
            inputElement.value = '';
        }
        
        // 移除資訊值
        function removeInfoValue(infoType, value) {
            // 從資料中移除
            infoData[infoType] = infoData[infoType].filter(item => item !== value);
            
            // 重新渲染該類別的所有值
            const valuesContainer = document.getElementById(`values-${infoType}`);
            valuesContainer.innerHTML = '';
            
            infoData[infoType].forEach(val => {
                const valueElement = document.createElement('div');
                valueElement.className = 'value-tag';
                valueElement.innerHTML = `
                    ${val} <button type="button" class="delete-btn" onclick="removeInfoValue('${infoType}', '${val}')">X</button>
                `;
                valuesContainer.appendChild(valueElement);
            });
        }
        
        // 表單提交
        document.getElementById('wordlistForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const statusDiv = document.getElementById('status');
            const outputDiv = document.getElementById('output');
            
            // 檢查是否添加了任何資訊
            let hasInfo = false;
            for (const type in infoData) {
                if (infoData[type].length > 0) {
                    hasInfo = true;
                    break;
                }
            }
            
            if (!hasInfo) {
                alert("Please add at least one piece of information.");
                return;
            }
            
            // 顯示處理狀態
            statusDiv.className = 'status';
            statusDiv.textContent = 'Processing request...';
            statusDiv.style.display = 'block';
            
            outputDiv.innerHTML = '> Starting wordlist generation...\n> Please wait, this may take a moment.';
            
            // 整理要發送的資料
            const formData = {
                output_filename: document.getElementById('output_filename').value,
                info_data: infoData
            };
            
            // 發送 JSON 資料到後端
            fetch('/WiFi/wordlist-generator', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Server error: ' + response.status);
                }
                return response.json();
            })
            .then(data => {
                if (data.success) {
                    statusDiv.textContent = 'Wordlist generated successfully!';
                    outputDiv.innerHTML = '> Wordlist generation complete.\n> File saved as: ' + data.filename + '\n> Generated ' + data.count + ' passwords.\n\n' + data.sample;
                    
                    if (data.download_link) {
                        const downloadLink = document.createElement('a');
                        downloadLink.href = data.download_link;
                        downloadLink.textContent = 'Download Wordlist';
                        downloadLink.className = 'download-link';
                        downloadLink.style.display = 'block';
                        downloadLink.style.marginTop = '20px';
                        downloadLink.style.color = '#00ffb3';
                        statusDiv.appendChild(downloadLink);
                    }
                } else {
                    statusDiv.className = 'status error';
                    statusDiv.textContent = 'Error: ' + data.error;
                    outputDiv.innerHTML += '\n> ERROR: ' + data.error;
                }
            })
            .catch(error => {
                statusDiv.className = 'status error';
                statusDiv.textContent = 'Error: ' + error.message;
                outputDiv.innerHTML += '\n> CONNECTION ERROR: ' + error.message;
            });
        });
        
        // 載入自定義字典檔案列表
        async function loadCustomWordlists() {
            const refreshButton = document.getElementById('refreshWordlists');
            const wordlistsList = document.getElementById('wordlistsList');
            
            refreshButton.disabled = true;
            refreshButton.textContent = 'Loading...';
            wordlistsList.innerHTML = '<p>Loading wordlists...</p>';
            
            try {
                const response = await fetch('/WiFi/wordlists/list');
                const data = await response.json();
                
                if (data.success) {
                    // 只顯示自定義字典 (category === 'custom')
                    const customWordlists = data.wordlists.filter(w => w.category === 'custom');
                    
                    if (customWordlists.length === 0) {
                        wordlistsList.innerHTML = '<p>No custom wordlists found. Generate one above to see it here.</p>';
                    } else {
                        let html = '<table class="wordlists-table">';
                        html += '<thead><tr><th>Filename</th><th>Size</th><th>Modified</th><th>Actions</th></tr></thead>';
                        html += '<tbody>';
                        
                        customWordlists.forEach(wordlist => {
                            const sizeKB = (wordlist.size / 1024).toFixed(2);
                            html += `
                                <tr>
                                    <td>${wordlist.filename}</td>
                                    <td>${sizeKB} KB</td>
                                    <td>${wordlist.modified}</td>
                                    <td>
                                        <a href="${wordlist.download_link}" class="action-btn download-btn" download>Download</a>
                                        <button class="action-btn delete-btn" onclick="deleteWordlist('${wordlist.filename}')">Delete</button>
                                    </td>
                                </tr>
                            `;
                        });
                        
                        html += '</tbody></table>';
                        wordlistsList.innerHTML = html;
                    }
                } else {
                    wordlistsList.innerHTML = `<p>Error loading wordlists: ${data.message}</p>`;
                }
            } catch (error) {
                wordlistsList.innerHTML = `<p>Error loading wordlists: ${error.message}</p>`;
            } finally {
                refreshButton.disabled = false;
                refreshButton.textContent = 'Refresh List';
            }
        }
        
        // 刪除字典檔案
        async function deleteWordlist(filename) {
            if (!confirm(`Are you sure you want to delete "${filename}"? This action cannot be undone.`)) {
                return;
            }
            
            try {
                const response = await fetch(`/WiFi/wordlists/custom/${filename}`, {
                    method: 'DELETE'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert(`Successfully deleted ${filename}`);
                    // 重新載入列表
                    loadCustomWordlists();
                } else {
                    alert(`Failed to delete ${filename}: ${data.message}`);
                }
            } catch (error) {
                alert(`Error deleting wordlist: ${error.message}`);
            }
        }
        
        // 頁面載入時自動載入字典列表
        window.addEventListener('load', function() {
            loadCustomWordlists();
        });
    </script>
</body>
</html>